<HTML>
<head>
<script type="text/javascript">
function detectLanguage()
{
    var results = '';
    var code = document.getElementById('code').value;
    var req = new XMLHttpRequest();
    req.open('POST', "/detect", true);
    req.setRequestHeader("Content-type", "text/plain");
    req.onload = function (e) {
      if (req.readyState === 4) {
        if (req.status === 200) {
          results = req.responseText;
          var div = document.getElementById('result');
          div.innerText = results
        } else {
          console.error(req.statusText);
        }
      }
    };
    req.onerror = function (e) {
      console.error(req.statusText);
    };
    req.send(code);
}

function tokenize()
{
    html_colors = {
      keyword: 'orchid',
      number: 'blue',
      string: 'salmon',
      operator: 'green',
      comment: 'yellowgreen',
      remark: 'yellowgreen',
      picture: 'hotpink'
    };

    var results = '';
    var code = document.getElementById('code').value;
    var language = document.getElementById('language').value;
    var query = "/tokens?language=" + language;
    var req = new XMLHttpRequest();
    req.open('POST', query, true);
    req.setRequestHeader("Content-type", "text/plain");
    req.onload = function (e) {
      if (req.readyState === 4) {
        if (req.status === 200) {
          results = req.responseText;
          data = JSON.parse(results)
          var div = document.getElementById('result');
          formatted_results = '<pre><code>';
          length = data.length;

          for (i = 0; i < length; i++) {
            item = data[i];
            item_type = item['type'];
            item_value = item['value'];
            if (item_type == 'newline') {
              formatted_results += '<br/>';
            } else if (item_type in html_colors) {
              front_html = '<font color=' + html_colors[item['type']] + '>';
              back_html = '</font>';
              formatted_results += front_html + item_value + back_html;
            } else {
              formatted_results += item_value;
            }
          }

          formatted_results += '</code></pre>'

          div.innerHTML = formatted_results;
        } else {
          console.error(req.statusText);
        }
      }
    };

    req.onerror = function (e) {
      console.error(req.statusText);
    };
    req.send(code);
}
</script>
</head>
<body>
Welcome to the CodeStat page!
<TEXTAREA cols="50" rows="20" id="code"></TEXTAREA>
<br/>
<input type="button" OnClick="detectLanguage();" value="Detect language"/>
<br/>
<input type="text" id="language"/>
<input type="button" OnClick="tokenize();" value="Tokenize"/>
<div id="result"></div>
</body>
</HTML>
